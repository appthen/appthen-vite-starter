var b=Object.defineProperty;var x=(w,r,t)=>r in w?b(w,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):w[r]=t;var n=(w,r,t)=>(x(w,typeof r!="symbol"?r+"":r,t),t);import{R as M,j as e}from"./index-0e900c2b.js";import{u as g,r as y,_ as j,l as s,I as f}from"./index-06395fc0.js";const V='<svg xmlns="http://www.w3.org/2000/svg"   viewBox="0 0 24 24"><path fill="#98b0f5" d="M7 23q-.825 0-1.413-.588T5 21V3q0-.825.588-1.413T7 1h10q.825 0 1.413.588T19 3v18q0 .825-.588 1.413T17 23H7Zm5-2.5q.425 0 .713-.288T13 19.5q0-.425-.288-.713T12 18.5q-.425 0-.713.288T11 19.5q0 .425.288.713T12 20.5ZM7 16h10V6H7v10Z"/></svg>',S='<svg xmlns="http://www.w3.org/2000/svg"   viewBox="0 0 24 24"><g fill="none" stroke="#98b0f5" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="m4 15l3 3l3-3M7 6v12m10-4a2 2 0 0 1 2 2v3a2 2 0 1 1-4 0v-3a2 2 0 0 1 2-2zm-2-9a2 2 0 1 0 4 0a2 2 0 1 0-4 0"/><path d="M19 5v3a2 2 0 0 1-2 2h-1.5"/></g></svg>',k='<svg xmlns="http://www.w3.org/2000/svg"   viewBox="0 0 24 24"><path fill="#98b0f5" d="M12 12q-1.65 0-2.825-1.175T8 8q0-1.65 1.175-2.825T12 4q1.65 0 2.825 1.175T16 8q0 1.65-1.175 2.825T12 12Zm-8 8v-2.8q0-.85.438-1.563T5.6 14.55q1.55-.775 3.15-1.163T12 13q1.65 0 3.25.388t3.15 1.162q.725.375 1.163 1.088T20 17.2V20H4Z"/></svg>',N='<svg xmlns="http://www.w3.org/2000/svg"   viewBox="0 0 24 24"><path fill="#98b0f5" fill-rule="evenodd" d="M3.172 5.172C2 6.343 2 8.229 2 12c0 3.771 0 5.657 1.172 6.828C4.343 20 6.229 20 10 20h4c3.771 0 5.657 0 6.828-1.172C22 17.657 22 15.771 22 12c0-3.771 0-5.657-1.172-6.828C19.657 4 17.771 4 14 4h-4C6.229 4 4.343 4 3.172 5.172ZM12.75 10a.75.75 0 0 0-1.5 0v.701l-.607-.35a.75.75 0 0 0-.75 1.298l.607.35l-.607.351a.75.75 0 1 0 .75 1.3l.607-.351V14a.75.75 0 0 0 1.5 0v-.7l.607.35a.75.75 0 0 0 .75-1.3L13.5 12l.607-.35a.75.75 0 0 0-.75-1.3l-.607.35V10Zm-6.017-.75a.75.75 0 0 1 .75.75v.7l.606-.35a.75.75 0 0 1 .75 1.3l-.607.35l.607.35a.75.75 0 1 1-.75 1.3l-.606-.35v.7a.75.75 0 0 1-1.5 0v-.701l-.608.35a.75.75 0 0 1-.75-1.298L5.232 12l-.607-.35a.75.75 0 1 1 .75-1.3l.608.351V10a.75.75 0 0 1 .75-.75Zm11.285.75a.75.75 0 0 0-1.5 0v.701l-.607-.35a.75.75 0 0 0-.75 1.298l.607.35l-.608.351a.75.75 0 0 0 .75 1.3l.608-.351V14a.75.75 0 0 0 1.5 0v-.7l.607.35a.75.75 0 0 0 .75-1.3l-.607-.35l.607-.35a.75.75 0 0 0-.75-1.3l-.607.35V10Z" clip-rule="evenodd"/></svg>',v={svg_s3sqia:V,svg_wd0w5s:S,svg_vxqwb8:k,svg_yopqq6:N};const{px:_,RefsManager:C,$eval:a,$evalArray:I,$createChildContext:A}=g;class Z extends M.Component{constructor(t,d){super(t);n(this,"_dataSourceConfig",this._defineDataSourceConfig());n(this,"_dataSourceEngine",g.dataSource(this._dataSourceConfig,this,{runtimeConfig:!0,requestHandlersMap:{fetch:y()}}));n(this,"reloadDataSource",async()=>{await this._dataSourceEngine.reloadDataSource()});n(this,"utils",Object.assign({getRoute:g.createRoute("login")},g));n(this,"constants",j);n(this,"_refsManager",new C);n(this,"$",t=>this._refsManager.get(t));n(this,"$$",t=>this._refsManager.getAll(t));this.state={req:{},isMobile:!1,tab:"smscode",countdown:0,getCode:{}}}get dataSourceMap(){return this._dataSourceEngine.dataSourceMap||{}}_defineDataSourceConfig(){const t=this;return{list:[{id:"req",isInit:function(){return!1},isSync:!1,type:"fetch",options:function(){return{uri:t.constants.HostDomain+"/system_user_login",contentType:"JSON",method:"POST",params:{username:t.state.tab==="smscode"?void 0:t.state.account,password:t.state.tab==="smscode"?void 0:t.state.password,type:t.state.tab==="smscode"?"phone":"username",code:t.state.tab==="smscode"?t.state.code:void 0,phone:t.state.tab==="smscode"?t.state.account:void 0},headers:{}}}},{id:"getCode",isInit:function(){return!1},isSync:!1,type:"fetch",options:function(){return{uri:t.constants.HostDomain+"/system_user_phone",contentType:"JSON",method:"POST",params:{phone:t.state.account},headers:{},timeout:15e3}}}]}}setStateValue(t,{field:d,valueField:o,indexs:i},l){const c={...this.state};let h=t;o&&(h=o.split(".").reduce((u,p)=>u&&u[p],t));const m=(i==null?void 0:i.length)>0?d.replace(/\.\[\]/g,u=>`[${i.shift()}].`).replace(".[item]",""):d;this.utils.setValue(c,m,h),this.setState(c,l)}async login(t){var c;const{account:d,code:o}=this.state,i=this.utils.message.loading(),l=await((c=this.dataSourceMap.req)==null?void 0:c.load());if(i(),l.code===0){const h=l.data;localStorage.setItem("accessToken",h),this.utils.setGlobalData("accessToken",h),this.utils.navigateTo("projectManagement"),this.utils.message.success("登录成功")}else this.state.tab==="smscode"&&l.code===429&&(this.utils.message.info("您是新用户，请输入密码完成注册"),this.utils.preload("LOGIN_FORM",{account:d,code:o})),this.utils.message.error(l.msg||"登录失败")}async getVerificationCode(t){var i,l,c;if(((i=this.state.account)==null?void 0:i.length)!==11)return this.utils.message.error("请输入正确的手机号");if(this.state.countdown>0)return this.utils.message.error("请稍等");const d=this.utils.message.loading(),o=await((l=this.dataSourceMap.getCode)==null?void 0:l.load());if(d(),(o==null?void 0:o.code)!==0)return this.utils.message.error((c=this.state.getCode)==null?void 0:c.msg);this.setState({countdown:60}),this.timer=setInterval(()=>{this.decreaseCountdown()},1e3)}decreaseCountdown(){this.setState(t=>({countdown:t.countdown-1}),()=>{this.state.countdown<1&&(clearInterval(this.timer),this.timer=null)})}componentDidMount(){this._dataSourceEngine.reloadDataSource(),this.utils.checkMobileTerminal()&&this.setState({isMobile:!0})}render(){return e.jsx(s.Page,{statusBarMode:"light",children:e.jsxs(s.View,{inlineStyle:[{enable:a(()=>this.state.isMobile),name:"动态样式1",style:{display:"flex",flexDirection:"column"}}],className:"login__vw",children:[e.jsx(s.View,{inlineStyle:[{enable:a(()=>this.state.isMobile),name:"动态样式1",style:{flex:0}}],ref:this._refsManager.linkRef("view-adb65814"),className:"login__vw__vw M-flex-item",children:e.jsx(s.Image,{style:a(()=>this.state.isMobile?{width:"auto",height:_(100)}:{width:"80%"}),src:"https://file.mengti.cc/FqgZfRkiyyY6CjhQ3eY4i4Z49HFv",remote:!1,fit:!1,ref:this._refsManager.linkRef("image-0d99267e")})}),e.jsx(s.View,{ref:this._refsManager.linkRef("view-da5f1527"),inlineStyle:[{enable:a(()=>this.state.isMobile),name:"动态样式1",style:{borderBottomLeftRadius:_(0)}}],className:"login__vw__vw1 M-flex-item",children:e.jsxs(s.View,{inlineStyle:[{enable:a(()=>this.state.isMobile),name:"动态样式1",style:{width:"100%",paddingLeft:_(15),paddingRight:_(15),flex:1,paddingTop:_(40)}}],ref:this._refsManager.linkRef("view-e808a761"),className:"login__vw__vw1__vw",children:[e.jsx(s.View,{ref:this._refsManager.linkRef("view-2115df3b"),children:e.jsxs(s.View,{ref:this._refsManager.linkRef("view-bdc4899f"),className:"login__vw_1 M-flex-item",children:[e.jsxs(s.View,{onClick:t=>{this.setStateValue("smscode",{field:"tab"})},ref:this._refsManager.linkRef("view-fba7f25a"),className:"login__vw_1__vw",children:[e.jsx(s.Text,{ref:this._refsManager.linkRef("text-b0e7fc50"),inlineStyle:[{enable:a(()=>this.state.tab!=="smscode"),name:"nosel",style:{fontWeight:400,fontSize:_(24)}}],className:"login__vw_1__vw__tx",children:"短信登录"}),e.jsx(s.View,{inlineStyle:[{enable:a(()=>this.state.tab==="smscode"),name:"动态样式1",style:{backgroundColor:"rgba(19,115,252,0.76)"}}],className:"login__vw_1__vw__vw1"})]}),e.jsxs(s.View,{onClick:t=>{this.setStateValue("password",{field:"tab"})},ref:this._refsManager.linkRef("view-e835ef9d"),className:"login__vw_1__vw1",children:[e.jsx(s.Text,{ref:this._refsManager.linkRef("text-b0e7fc50"),inlineStyle:[{enable:a(()=>this.state.tab!=="password"),name:"nosql",style:{fontWeight:400,color:"#606060",fontSize:_(24)}}],className:"login__vw_1__vw1__tx",children:"账号密码"}),e.jsx(s.View,{inlineStyle:[{enable:a(()=>this.state.tab==="password"),name:"动态样式1",style:{backgroundColor:"rgba(19,115,252,0.76)"}}],ref:this._refsManager.linkRef("view-b7f6e0e1"),className:"login__vw_1__vw1__vw1"})]})]})}),!!a(()=>this.state.tab==="smscode")&&e.jsx(s.View,{ref:this._refsManager.linkRef("view-fe1bddac"),children:e.jsxs(s.View,{ref:this._refsManager.linkRef("view-fe1bddac"),children:[e.jsxs(s.View,{ref:this._refsManager.linkRef("view-6d99607f"),className:"login__vw_2",children:[e.jsx(s.View,{className:"login__vw_2__vw",children:e.jsx(s.AtIcon,{color:"#98b0f5",size:22,svg:v.svg_s3sqia})}),e.jsx(s.View,{ref:this._refsManager.linkRef("view-6c65f6d1"),className:"login__vw_2__vw1 M-flex-item",children:e.jsx(f,{placeholder:"手机号",bordered:!1,disabled:!1,allowClear:!0,value:a(()=>this.state.account),onChange:function(){return this.setStateValue.apply(this,Array.prototype.slice.call(arguments).concat([{field:"account",valueField:"target.value"}]))}.bind(this),className:"login__vw_2__vw1__Input"})})]}),e.jsxs(s.View,{ref:this._refsManager.linkRef("view-6d99607f"),className:"login__vw1",children:[e.jsx(s.View,{className:"login__vw1__vw",children:e.jsx(s.AtIcon,{color:"#98b0f5",size:22,svg:v.svg_wd0w5s})}),e.jsx(s.View,{ref:this._refsManager.linkRef("view-6c65f6d1"),className:"login__vw1__vw1 M-flex-item",children:e.jsx(f,{placeholder:"验证码",bordered:!1,disabled:!1,allowClear:!0,value:a(()=>this.state.code),onChange:function(){return this.setStateValue.apply(this,Array.prototype.slice.call(arguments).concat([{field:"code",valueField:"target.value"}]))}.bind(this),className:"login__vw1__vw1__Input"})}),e.jsx(s.View,{ref:this._refsManager.linkRef("view-6c65f6d1"),className:"login__vw1__vw2",children:e.jsxs(s.View,{className:"login__vw1__vw2__vw",ref:this._refsManager.linkRef("view-f7d71db3"),onClick:function(){return this.getVerificationCode.apply(this,Array.prototype.slice.call(arguments).concat([]))}.bind(this),inlineStyle:[{enable:a(()=>this.state.countdown>0),name:"动态样式1",style:{backgroundColor:"#eaeaea",borderColor:"#d6d6d6",borderWidth:_(1),borderStyle:"solid"}}],children:[e.jsx(s.Text,{inlineStyle:[{enable:a(()=>this.state.countdown>0),name:"动态样式1",style:{color:"#767676"}}],className:"login__vw1__vw2__vw__tx",children:a(()=>this.state.countdown>0?`${this.state.countdown} 秒后重新获取`:"获取验证码")}),e.jsx(s.View,{className:"login__vw1__vw2__vw__vw1"})]})})]})]})}),!!a(()=>this.state.tab==="password")&&e.jsxs(s.View,{ref:this._refsManager.linkRef("view-dc8d1bab"),children:[e.jsxs(s.View,{ref:this._refsManager.linkRef("view-6d99607f"),className:"login__vw_3",children:[e.jsx(s.View,{className:"login__vw_3__vw",children:e.jsx(s.AtIcon,{color:"#98b0f5",size:24,svg:v.svg_vxqwb8})}),e.jsx(s.View,{ref:this._refsManager.linkRef("view-6c65f6d1"),className:"login__vw_3__vw1 M-flex-item",children:e.jsx(f,{placeholder:"用户名",bordered:!1,disabled:!1,allowClear:!0,value:a(()=>this.state.account),onChange:function(){return this.setStateValue.apply(this,Array.prototype.slice.call(arguments).concat([{field:"account",valueField:"target.value"}]))}.bind(this),className:"login__vw_3__vw1__Input"})})]}),e.jsxs(s.View,{ref:this._refsManager.linkRef("view-8c39348d"),className:"login__vw1_4",children:[e.jsx(s.View,{className:"login__vw1_4__vw",children:e.jsx(s.AtIcon,{color:"#98b0f5",size:24,svg:v.svg_yopqq6})}),e.jsx(s.View,{ref:this._refsManager.linkRef("view-45020ec7"),className:"login__vw1_4__vw1 M-flex-item",children:e.jsx(f.Password,{bordered:!1,disabled:!1,visibilityToggle:!0,placeholder:"密码",value:a(()=>this.state.password),onChange:function(){return this.setStateValue.apply(this,Array.prototype.slice.call(arguments).concat([{field:"password",valueField:"target.value"}]))}.bind(this),onPressEnter:function(){return this.login.apply(this,Array.prototype.slice.call(arguments).concat([]))}.bind(this),className:"login__vw1_4__vw1__Input.Password"})})]})]}),e.jsxs(s.View,{className:"login__vw__vw1__vw__vw3",children:[e.jsx(s.View,{onClick:t=>{this.utils.navigateTo("register")},className:"login__vw__vw1__vw__vw3__vw M-gb-click",ref:this._refsManager.linkRef("view-3dcd2eb1"),children:e.jsx(s.Text,{className:"login__vw__vw1__vw__vw3__vw__tx",children:"新用户注册"})}),e.jsx(s.View,{ref:this._refsManager.linkRef("view-b472bd07"),className:"login__vw__vw1__vw__vw3__vw1 M-flex-item"})]}),e.jsxs(s.View,{onClick:function(){return this.login.apply(this,Array.prototype.slice.call(arguments).concat([]))}.bind(this),className:"login__vw__vw1__vw__vw4 M-gb-click",ref:this._refsManager.linkRef("view-7e4b67c5"),children:[e.jsx(s.Text,{className:"login__vw__vw1__vw__vw4__tx",children:"登录"}),e.jsx(s.View,{className:"login__vw__vw1__vw__vw4__vw1"})]})]})})]})})}}export{Z as default};
