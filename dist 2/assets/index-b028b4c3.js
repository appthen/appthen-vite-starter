var x=Object.defineProperty;var y=(_,i,t)=>i in _?x(_,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):_[i]=t;var a=(_,i,t)=>(y(_,typeof i!="symbol"?i+"":i,t),t);import{R as b,j as e}from"./index-8eca1183.js";import{u as d,r as M,_ as S,l as s,I as f}from"./index-fa05e7dd.js";const j='<svg xmlns="http://www.w3.org/2000/svg"   viewBox="0 0 24 24"><path fill="#98b0f5" d="M12 12q-1.65 0-2.825-1.175T8 8q0-1.65 1.175-2.825T12 4q1.65 0 2.825 1.175T16 8q0 1.65-1.175 2.825T12 12Zm-8 8v-2.8q0-.85.438-1.563T5.6 14.55q1.55-.775 3.15-1.163T12 13q1.65 0 3.25.388t3.15 1.162q.725.375 1.163 1.088T20 17.2V20H4Z"/></svg>',V='<svg xmlns="http://www.w3.org/2000/svg"   viewBox="0 0 24 24"><path fill="#98b0f5" fill-rule="evenodd" d="M3.172 5.172C2 6.343 2 8.229 2 12c0 3.771 0 5.657 1.172 6.828C4.343 20 6.229 20 10 20h4c3.771 0 5.657 0 6.828-1.172C22 17.657 22 15.771 22 12c0-3.771 0-5.657-1.172-6.828C19.657 4 17.771 4 14 4h-4C6.229 4 4.343 4 3.172 5.172ZM12.75 10a.75.75 0 0 0-1.5 0v.701l-.607-.35a.75.75 0 0 0-.75 1.298l.607.35l-.607.351a.75.75 0 1 0 .75 1.3l.607-.351V14a.75.75 0 0 0 1.5 0v-.7l.607.35a.75.75 0 0 0 .75-1.3L13.5 12l.607-.35a.75.75 0 0 0-.75-1.3l-.607.35V10Zm-6.017-.75a.75.75 0 0 1 .75.75v.7l.606-.35a.75.75 0 0 1 .75 1.3l-.607.35l.607.35a.75.75 0 1 1-.75 1.3l-.606-.35v.7a.75.75 0 0 1-1.5 0v-.701l-.608.35a.75.75 0 0 1-.75-1.298L5.232 12l-.607-.35a.75.75 0 1 1 .75-1.3l.608.351V10a.75.75 0 0 1 .75-.75Zm11.285.75a.75.75 0 0 0-1.5 0v.701l-.607-.35a.75.75 0 0 0-.75 1.298l.607.35l-.608.351a.75.75 0 0 0 .75 1.3l.608-.351V14a.75.75 0 0 0 1.5 0v-.7l.607.35a.75.75 0 0 0 .75-1.3l-.607-.35l.607-.35a.75.75 0 0 0-.75-1.3l-.607.35V10Z" clip-rule="evenodd"/></svg>',C='<svg xmlns="http://www.w3.org/2000/svg"   viewBox="0 0 24 24"><path fill="#98b0f5" fill-rule="evenodd" d="M3.172 5.172C2 6.343 2 8.229 2 12c0 3.771 0 5.657 1.172 6.828C4.343 20 6.229 20 10 20h4c3.771 0 5.657 0 6.828-1.172C22 17.657 22 15.771 22 12c0-3.771 0-5.657-1.172-6.828C19.657 4 17.771 4 14 4h-4C6.229 4 4.343 4 3.172 5.172ZM12.75 10a.75.75 0 0 0-1.5 0v.701l-.607-.35a.75.75 0 0 0-.75 1.298l.607.35l-.607.351a.75.75 0 1 0 .75 1.3l.607-.351V14a.75.75 0 0 0 1.5 0v-.7l.607.35a.75.75 0 0 0 .75-1.3L13.5 12l.607-.35a.75.75 0 0 0-.75-1.3l-.607.35V10Zm-6.017-.75a.75.75 0 0 1 .75.75v.7l.606-.35a.75.75 0 0 1 .75 1.3l-.607.35l.607.35a.75.75 0 1 1-.75 1.3l-.606-.35v.7a.75.75 0 0 1-1.5 0v-.701l-.608.35a.75.75 0 0 1-.75-1.298L5.232 12l-.607-.35a.75.75 0 1 1 .75-1.3l.608.351V10a.75.75 0 0 1 .75-.75Zm11.285.75a.75.75 0 0 0-1.5 0v.701l-.607-.35a.75.75 0 0 0-.75 1.298l.607.35l-.608.351a.75.75 0 0 0 .75 1.3l.608-.351V14a.75.75 0 0 0 1.5 0v-.7l.607.35a.75.75 0 0 0 .75-1.3l-.607-.35l.607-.35a.75.75 0 0 0-.75-1.3l-.607.35V10Z" clip-rule="evenodd"/></svg>',p={svg_2x9ehs:j,svg_9h4qu6:V,svg_bui1bb:C};const{px:v,RefsManager:N,$eval:r,$evalArray:I,$createChildContext:Z}=d;class k extends b.Component{constructor(t,n){super(t);a(this,"_dataSourceConfig",this._defineDataSourceConfig());a(this,"_dataSourceEngine",d.dataSource(this._dataSourceConfig,this,{runtimeConfig:!0,requestHandlersMap:{fetch:M()}}));a(this,"reloadDataSource",async()=>{await this._dataSourceEngine.reloadDataSource()});a(this,"utils",Object.assign({getRoute:d.createRoute("register")},d));a(this,"constants",S);a(this,"_refsManager",new N);a(this,"$",t=>this._refsManager.get(t));a(this,"$$",t=>this._refsManager.getAll(t));this.state={req:{},isMobile:!1,req_1:{}}}get dataSourceMap(){return this._dataSourceEngine.dataSourceMap||{}}_defineDataSourceConfig(){const t=this;return{list:[{id:"req",isInit:function(){return!1},isSync:!1,type:"fetch",options:function(){return{uri:t.constants.HostDomain+"/system_user_register",contentType:"JSON",method:"POST",params:{username:t.state.account,password:t.state.password},headers:{}}}},{id:"req_1",isInit:function(){return!1},isSync:!1,type:"fetch",options:function(){return{uri:t.constants.HostDomain+"/system_user_login",contentType:"JSON",method:"POST",params:{username:t.state.account,password:t.state.password},headers:{}}}}]}}setStateValue(t,{field:n,valueField:w,indexs:o},m){const l={...this.state};let c=t;w&&(c=w.split(".").reduce((u,h)=>u&&u[h],t));const g=(o==null?void 0:o.length)>0?n.replace(/\.\[\]/g,u=>`[${o.shift()}].`).replace(".[item]",""):n;this.utils.setValue(l,g,c),this.setState(l,m)}async register(t){var c,g;const{account:n,password:w,code:o}=this.state;if(!n||!w)return this.utils.message.error("请填写用户名、密码");const m=this.utils.message.loading(),l=await((c=this.dataSourceMap.req)==null?void 0:c.load());if(m(),l.code===0)if((await((g=this.dataSourceMap.req_1)==null?void 0:g.load())).code===0){const h=l.data;localStorage.setItem("accessToken",h),this.utils.setGlobalData("accessToken",h),this.utils.navigateTo("projectManagement"),this.utils.message.success("注册成功, 请登录吧")}else this.utils.message.error(l.msg||"登录失败"),this.utils.navigateTo("login");else this.utils.message.error(l.msg||"注册失败")}componentDidMount(){this._dataSourceEngine.reloadDataSource(),this.utils.checkMobileTerminal()&&this.setState({isMobile:!0})}render(){return e.jsx(s.Page,{statusBarMode:"light",children:e.jsxs(s.View,{inlineStyle:[{enable:r(()=>this.state.isMobile),name:"动态样式1",style:{display:"flex",flexDirection:"column"}}],className:"register__vw",children:[e.jsx(s.View,{inlineStyle:[{enable:r(()=>this.state.isMobile),name:"动态样式1",style:{flex:0}}],className:"register__vw__vw M-flex-item",children:e.jsx(s.Image,{style:r(()=>this.state.isMobile?{width:"auto",height:v(100)}:{width:"80%"}),src:"https://file.mengti.cc/FqgZfRkiyyY6CjhQ3eY4i4Z49HFv",remote:!1,fit:!1})}),e.jsx(s.View,{inlineStyle:[{enable:r(()=>this.state.isMobile),name:"动态样式1",style:{display:"flex",flexDirection:"column",alignItems:"flex-start",justifyContent:"flex-start",paddingTop:v(30),paddingLeft:v(20),paddingRight:v(20),borderBottomLeftRadius:v(0)}}],className:"register__vw__vw1 M-flex-item",children:e.jsxs(s.View,{inlineStyle:[{enable:r(()=>this.state.isMobile),name:"动态样式1",style:{width:"100%"}}],className:"register__vw__vw1__vw",children:[e.jsx(s.View,{children:e.jsx(s.Text,{className:"register__tx",children:"新用户注册"})}),e.jsx(s.View,{className:"register__vw__vw1__vw__vw1",children:e.jsx(s.Text,{ref:this._refsManager.linkRef("text-ac6a8287"),className:"register__vw__vw1__vw__vw1__tx"})}),e.jsxs(s.View,{className:"register__vw__vw1__vw__vw2",children:[e.jsx(s.View,{className:"register__vw__vw1__vw__vw2__vw",children:e.jsx(s.AtIcon,{color:"#98b0f5",size:24,svg:p.svg_2x9ehs})}),e.jsx(s.View,{className:"register__vw__vw1__vw__vw2__vw1 M-flex-item",children:e.jsx(f,{placeholder:"用户名",bordered:!1,disabled:!1,allowClear:!0,value:r(()=>this.state.account),onChange:function(){return this.setStateValue.apply(this,Array.prototype.slice.call(arguments).concat([{field:"account",valueField:"target.value"}]))}.bind(this),ref:this._refsManager.linkRef("input-3eae6345"),className:"register__vw__vw1__vw__vw2__vw1__Input"})})]}),e.jsxs(s.View,{className:"register__vw__vw1__vw__vw3",children:[e.jsx(s.View,{className:"register__vw__vw1__vw__vw3__vw",children:e.jsx(s.AtIcon,{color:"#98b0f5",size:24,svg:p.svg_9h4qu6})}),e.jsx(s.View,{className:"register__vw__vw1__vw__vw3__vw1 M-flex-item",children:e.jsx(f.Password,{bordered:!1,disabled:!1,visibilityToggle:!0,placeholder:"密码",value:r(()=>this.state.password),onChange:function(){return this.setStateValue.apply(this,Array.prototype.slice.call(arguments).concat([{field:"password",valueField:"target.value"}]))}.bind(this),onPressEnter:function(){return this.register.apply(this,Array.prototype.slice.call(arguments).concat([]))}.bind(this),className:"register__vw__vw1__vw__vw3__vw1__Input.Password"})})]}),!1,e.jsxs(s.View,{className:"register__vw__vw1__vw__vw5",children:[e.jsx(s.View,{onClick:t=>{this.utils.navigateTo("login")},className:"register__vw__vw1__vw__vw5__vw M-gb-click",children:e.jsx(s.Text,{className:"register__vw__vw1__vw__vw5__vw__tx",children:"已有账号？去登录"})}),e.jsx(s.View,{className:"register__vw__vw1__vw__vw5__vw1 M-flex-item"})]}),e.jsxs(s.View,{onClick:function(){return this.register.apply(this,Array.prototype.slice.call(arguments).concat([]))}.bind(this),className:"register__vw__vw1__vw__vw6 M-gb-click",children:[e.jsx(s.Text,{className:"register__vw__vw1__vw__vw6__tx",children:"确认注册"}),e.jsx(s.View,{className:"register__vw__vw1__vw__vw6__vw1"})]})]})})]})})}}export{k as default};
