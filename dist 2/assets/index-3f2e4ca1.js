var x=Object.defineProperty;var M=(n,i,t)=>i in n?x(n,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[i]=t;var a=(n,i,t)=>(M(n,typeof i!="symbol"?i+"":i,t),t);import{R as b,j as e}from"./index-8eca1183.js";import{u as h,r as y,_ as j,l as s,I as f}from"./index-fa05e7dd.js";const S='<svg xmlns="http://www.w3.org/2000/svg"   viewBox="0 0 24 24"><path fill="#98b0f5" d="M12 12q-1.65 0-2.825-1.175T8 8q0-1.65 1.175-2.825T12 4q1.65 0 2.825 1.175T16 8q0 1.65-1.175 2.825T12 12Zm-8 8v-2.8q0-.85.438-1.563T5.6 14.55q1.55-.775 3.15-1.163T12 13q1.65 0 3.25.388t3.15 1.162q.725.375 1.163 1.088T20 17.2V20H4Z"/></svg>',V='<svg xmlns="http://www.w3.org/2000/svg"   viewBox="0 0 24 24"><path fill="#98b0f5" fill-rule="evenodd" d="M3.172 5.172C2 6.343 2 8.229 2 12c0 3.771 0 5.657 1.172 6.828C4.343 20 6.229 20 10 20h4c3.771 0 5.657 0 6.828-1.172C22 17.657 22 15.771 22 12c0-3.771 0-5.657-1.172-6.828C19.657 4 17.771 4 14 4h-4C6.229 4 4.343 4 3.172 5.172ZM12.75 10a.75.75 0 0 0-1.5 0v.701l-.607-.35a.75.75 0 0 0-.75 1.298l.607.35l-.607.351a.75.75 0 1 0 .75 1.3l.607-.351V14a.75.75 0 0 0 1.5 0v-.7l.607.35a.75.75 0 0 0 .75-1.3L13.5 12l.607-.35a.75.75 0 0 0-.75-1.3l-.607.35V10Zm-6.017-.75a.75.75 0 0 1 .75.75v.7l.606-.35a.75.75 0 0 1 .75 1.3l-.607.35l.607.35a.75.75 0 1 1-.75 1.3l-.606-.35v.7a.75.75 0 0 1-1.5 0v-.701l-.608.35a.75.75 0 0 1-.75-1.298L5.232 12l-.607-.35a.75.75 0 1 1 .75-1.3l.608.351V10a.75.75 0 0 1 .75-.75Zm11.285.75a.75.75 0 0 0-1.5 0v.701l-.607-.35a.75.75 0 0 0-.75 1.298l.607.35l-.608.351a.75.75 0 0 0 .75 1.3l.608-.351V14a.75.75 0 0 0 1.5 0v-.7l.607.35a.75.75 0 0 0 .75-1.3l-.607-.35l.607-.35a.75.75 0 0 0-.75-1.3l-.607.35V10Z" clip-rule="evenodd"/></svg>',u={svg_1306w6:S,svg_b3sbnk:V};const{px:v,RefsManager:N,$eval:l,$evalArray:C,$createChildContext:q}=h;class I extends b.Component{constructor(t,r){super(t);a(this,"_dataSourceConfig",this._defineDataSourceConfig());a(this,"_dataSourceEngine",h.dataSource(this._dataSourceConfig,this,{runtimeConfig:!0,requestHandlersMap:{fetch:y()}}));a(this,"reloadDataSource",async()=>{await this._dataSourceEngine.reloadDataSource()});a(this,"utils",Object.assign({getRoute:h.createRoute("login")},h));a(this,"constants",j);a(this,"_refsManager",new N);a(this,"$",t=>this._refsManager.get(t));a(this,"$$",t=>this._refsManager.getAll(t));this.state={req:{},isMobile:!1}}get dataSourceMap(){return this._dataSourceEngine.dataSourceMap||{}}_defineDataSourceConfig(){const t=this;return{list:[{id:"req",isInit:function(){return!1},isSync:!1,type:"fetch",options:function(){return{uri:t.constants.HostDomain+"/system_user_login",contentType:"JSON",method:"POST",params:{username:t.state.account,password:t.state.password},headers:{}}}}]}}setStateValue(t,{field:r,valueField:g,indexs:_},o){const c={...this.state};let w=t;g&&(w=g.split(".").reduce((d,p)=>d&&d[p],t));const m=(_==null?void 0:_.length)>0?r.replace(/\.\[\]/g,d=>`[${_.shift()}].`).replace(".[item]",""):r;this.utils.setValue(c,m,w),this.setState(c,o)}async login(t){var c;const{account:r,password:g}=this.state;if(!r||!g)return this.utils.message.error("请输入用户名密码");const _=this.utils.message.loading(),o=await((c=this.dataSourceMap.req)==null?void 0:c.load());if(_(),o.code===0){const w=o.data;localStorage.setItem("accessToken",w),this.utils.setGlobalData("accessToken",w),this.utils.navigateTo("projectManagement"),this.utils.message.success("登录成功")}else this.utils.message.error(o.msg||"登录失败")}componentDidMount(){this._dataSourceEngine.reloadDataSource(),this.utils.checkMobileTerminal()&&this.setState({isMobile:!0})}render(){return e.jsx(s.Page,{statusBarMode:"light",children:e.jsxs(s.View,{inlineStyle:[{enable:l(()=>this.state.isMobile),name:"动态样式1",style:{display:"flex",flexDirection:"column"}}],className:"login__vw",children:[e.jsx(s.View,{inlineStyle:[{enable:l(()=>this.state.isMobile),name:"动态样式1",style:{flex:0}}],ref:this._refsManager.linkRef("view-adb65814"),className:"login__vw__vw M-flex-item",children:e.jsx(s.Image,{style:l(()=>this.state.isMobile?{width:"auto",height:v(100)}:{width:"80%"}),src:"https://file.mengti.cc/FqgZfRkiyyY6CjhQ3eY4i4Z49HFv",remote:!1,fit:!1,ref:this._refsManager.linkRef("image-0d99267e")})}),e.jsx(s.View,{ref:this._refsManager.linkRef("view-da5f1527"),inlineStyle:[{enable:l(()=>this.state.isMobile),name:"动态样式1",style:{borderBottomLeftRadius:v(0)}}],className:"login__vw__vw1 M-flex-item",children:e.jsxs(s.View,{inlineStyle:[{enable:l(()=>this.state.isMobile),name:"动态样式1",style:{width:"100%",paddingLeft:v(15),paddingRight:v(15),flex:1,paddingTop:v(40)}}],ref:this._refsManager.linkRef("view-e808a761"),className:"login__vw__vw1__vw",children:[e.jsx(s.View,{ref:this._refsManager.linkRef("view-2115df3b"),children:e.jsx(s.Text,{className:"login__tx",children:"账户登录"})}),e.jsx(s.View,{className:"login__vw__vw1__vw__vw1",children:e.jsx(s.Text,{className:"login__vw__vw1__vw__vw1__tx",children:"欢迎回来！请输入账号密码登录吧"})}),e.jsxs(s.View,{ref:this._refsManager.linkRef("view-6d99607f"),className:"login__vw__vw1__vw__vw2",children:[e.jsx(s.View,{className:"login__vw__vw1__vw__vw2__vw",children:e.jsx(s.AtIcon,{color:"#98b0f5",size:24,svg:u.svg_1306w6})}),e.jsx(s.View,{ref:this._refsManager.linkRef("view-6c65f6d1"),className:"login__vw__vw1__vw__vw2__vw1 M-flex-item",children:e.jsx(f,{placeholder:"用户名",bordered:!1,disabled:!1,allowClear:!0,value:l(()=>this.state.account),onChange:function(){return this.setStateValue.apply(this,Array.prototype.slice.call(arguments).concat([{field:"account",valueField:"target.value"}]))}.bind(this),className:"login__vw__vw1__vw__vw2__vw1__Input"})})]}),e.jsxs(s.View,{ref:this._refsManager.linkRef("view-8c39348d"),className:"login__vw__vw1__vw__vw3",children:[e.jsx(s.View,{className:"login__vw__vw1__vw__vw3__vw",children:e.jsx(s.AtIcon,{color:"#98b0f5",size:24,svg:u.svg_b3sbnk})}),e.jsx(s.View,{ref:this._refsManager.linkRef("view-45020ec7"),className:"login__vw__vw1__vw__vw3__vw1 M-flex-item",children:e.jsx(f.Password,{bordered:!1,disabled:!1,visibilityToggle:!0,placeholder:"密码",value:l(()=>this.state.password),onChange:function(){return this.setStateValue.apply(this,Array.prototype.slice.call(arguments).concat([{field:"password",valueField:"target.value"}]))}.bind(this),onPressEnter:function(){return this.login.apply(this,Array.prototype.slice.call(arguments).concat([]))}.bind(this),className:"login__vw__vw1__vw__vw3__vw1__Input.Password"})})]}),e.jsxs(s.View,{className:"login__vw__vw1__vw__vw4",children:[e.jsx(s.View,{onClick:t=>{this.utils.navigateTo("register")},className:"login__vw__vw1__vw__vw4__vw M-gb-click",ref:this._refsManager.linkRef("view-3dcd2eb1"),children:e.jsx(s.Text,{className:"login__vw__vw1__vw__vw4__vw__tx",children:"新用户注册"})}),e.jsx(s.View,{ref:this._refsManager.linkRef("view-b472bd07"),className:"login__vw__vw1__vw__vw4__vw1 M-flex-item"})]}),e.jsxs(s.View,{onClick:function(){return this.login.apply(this,Array.prototype.slice.call(arguments).concat([]))}.bind(this),className:"login__vw__vw1__vw__vw5 M-gb-click",ref:this._refsManager.linkRef("view-7e4b67c5"),children:[e.jsx(s.Text,{className:"login__vw__vw1__vw__vw5__tx",children:"登录"}),e.jsx(s.View,{className:"login__vw__vw1__vw__vw5__vw1"})]})]})})]})})}}export{I as default};
