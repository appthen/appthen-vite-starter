var x=Object.defineProperty;var y=(r,i,t)=>i in r?x(r,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[i]=t;var a=(r,i,t)=>(y(r,typeof i!="symbol"?i+"":i,t),t);import{R as M,j as e}from"./index-cb2f7489.js";import{u as h,r as b,_ as S,l as s,I as m}from"./index-7a435d27.js";const j='<svg xmlns="http://www.w3.org/2000/svg"   viewBox="0 0 24 24"><path fill="#98b0f5" d="M12 12q-1.65 0-2.825-1.175T8 8q0-1.65 1.175-2.825T12 4q1.65 0 2.825 1.175T16 8q0 1.65-1.175 2.825T12 12Zm-8 8v-2.8q0-.85.438-1.563T5.6 14.55q1.55-.775 3.15-1.163T12 13q1.65 0 3.25.388t3.15 1.162q.725.375 1.163 1.088T20 17.2V20H4Z"/></svg>',V='<svg xmlns="http://www.w3.org/2000/svg"   viewBox="0 0 24 24"><path fill="#98b0f5" fill-rule="evenodd" d="M3.172 5.172C2 6.343 2 8.229 2 12c0 3.771 0 5.657 1.172 6.828C4.343 20 6.229 20 10 20h4c3.771 0 5.657 0 6.828-1.172C22 17.657 22 15.771 22 12c0-3.771 0-5.657-1.172-6.828C19.657 4 17.771 4 14 4h-4C6.229 4 4.343 4 3.172 5.172ZM12.75 10a.75.75 0 0 0-1.5 0v.701l-.607-.35a.75.75 0 0 0-.75 1.298l.607.35l-.607.351a.75.75 0 1 0 .75 1.3l.607-.351V14a.75.75 0 0 0 1.5 0v-.7l.607.35a.75.75 0 0 0 .75-1.3L13.5 12l.607-.35a.75.75 0 0 0-.75-1.3l-.607.35V10Zm-6.017-.75a.75.75 0 0 1 .75.75v.7l.606-.35a.75.75 0 0 1 .75 1.3l-.607.35l.607.35a.75.75 0 1 1-.75 1.3l-.606-.35v.7a.75.75 0 0 1-1.5 0v-.701l-.608.35a.75.75 0 0 1-.75-1.298L5.232 12l-.607-.35a.75.75 0 1 1 .75-1.3l.608.351V10a.75.75 0 0 1 .75-.75Zm11.285.75a.75.75 0 0 0-1.5 0v.701l-.607-.35a.75.75 0 0 0-.75 1.298l.607.35l-.608.351a.75.75 0 0 0 .75 1.3l.608-.351V14a.75.75 0 0 0 1.5 0v-.7l.607.35a.75.75 0 0 0 .75-1.3l-.607-.35l.607-.35a.75.75 0 0 0-.75-1.3l-.607.35V10Z" clip-rule="evenodd"/></svg>',C='<svg xmlns="http://www.w3.org/2000/svg"   viewBox="0 0 24 24"><path fill="#98b0f5" fill-rule="evenodd" d="M3.172 5.172C2 6.343 2 8.229 2 12c0 3.771 0 5.657 1.172 6.828C4.343 20 6.229 20 10 20h4c3.771 0 5.657 0 6.828-1.172C22 17.657 22 15.771 22 12c0-3.771 0-5.657-1.172-6.828C19.657 4 17.771 4 14 4h-4C6.229 4 4.343 4 3.172 5.172ZM12.75 10a.75.75 0 0 0-1.5 0v.701l-.607-.35a.75.75 0 0 0-.75 1.298l.607.35l-.607.351a.75.75 0 1 0 .75 1.3l.607-.351V14a.75.75 0 0 0 1.5 0v-.7l.607.35a.75.75 0 0 0 .75-1.3L13.5 12l.607-.35a.75.75 0 0 0-.75-1.3l-.607.35V10Zm-6.017-.75a.75.75 0 0 1 .75.75v.7l.606-.35a.75.75 0 0 1 .75 1.3l-.607.35l.607.35a.75.75 0 1 1-.75 1.3l-.606-.35v.7a.75.75 0 0 1-1.5 0v-.701l-.608.35a.75.75 0 0 1-.75-1.298L5.232 12l-.607-.35a.75.75 0 1 1 .75-1.3l.608.351V10a.75.75 0 0 1 .75-.75Zm11.285.75a.75.75 0 0 0-1.5 0v.701l-.607-.35a.75.75 0 0 0-.75 1.298l.607.35l-.608.351a.75.75 0 0 0 .75 1.3l.608-.351V14a.75.75 0 0 0 1.5 0v-.7l.607.35a.75.75 0 0 0 .75-1.3l-.607-.35l.607-.35a.75.75 0 0 0-.75-1.3l-.607.35V10Z" clip-rule="evenodd"/></svg>',p={svg_shoabc:j,svg_2po9fe:V,svg_t37vld:C};const{px:w,RefsManager:N,$eval:l,$evalArray:I,$createChildContext:Z}=h;class k extends M.Component{constructor(t,o){super(t);a(this,"_dataSourceConfig",this._defineDataSourceConfig());a(this,"_dataSourceEngine",h.dataSource(this._dataSourceConfig,this,{runtimeConfig:!0,requestHandlersMap:{fetch:b()}}));a(this,"reloadDataSource",async()=>{await this._dataSourceEngine.reloadDataSource()});a(this,"utils",Object.assign({getRoute:h.createRoute("register")},h));a(this,"constants",S);a(this,"_refsManager",new N);a(this,"$",t=>this._refsManager.get(t));a(this,"$$",t=>this._refsManager.getAll(t));this.state={req:{},isMobile:!1,req_1:{}}}get dataSourceMap(){return this._dataSourceEngine.dataSourceMap||{}}_defineDataSourceConfig(){const t=this;return{list:[{id:"req",isInit:function(){return!1},isSync:!1,type:"fetch",options:function(){return{uri:t.constants.HostDomain+"/system_user_register",contentType:"JSON",method:"POST",params:{username:t.state.account,password:t.state.password},headers:{}}}},{id:"req_1",isInit:function(){return!1},isSync:!1,type:"fetch",options:function(){return{uri:t.constants.HostDomain+"/system_user_login",contentType:"JSON",method:"POST",params:{username:t.state.account,password:t.state.password},headers:{}}}}]}}setStateValue(t,{field:o,valueField:g,indexs:c},f){const _={...this.state};let v=t;g&&(v=g.split(".").reduce((n,d)=>n&&n[d],t));const u=(c==null?void 0:c.length)>0?o.replace(/\.\[\]/g,n=>`[${c.shift()}].`).replace(".[item]",""):o;this.utils.setValue(_,u,v),this.setState(_,f)}async register(t){var v,u;const{account:o,password:g,code:c}=this.state;if(!o||!g)return this.utils.message.error("请填写用户名、密码");const f=this.utils.message.loading(),_=await((v=this.dataSourceMap.req)==null?void 0:v.load());if(f(),_.code===0){const n=await((u=this.dataSourceMap.req_1)==null?void 0:u.load());if(n.code===0){const d=n.data;localStorage.setItem("accessToken",d),this.utils.setGlobalData("accessToken",d),this.utils.navigateTo("projectManagement"),this.utils.message.success("登录成功")}else this.utils.message.error(_.msg||"登录失败"),this.utils.navigateTo("login")}else this.utils.message.error(_.msg||"注册失败")}componentDidMount(){this._dataSourceEngine.reloadDataSource(),this.utils.checkMobileTerminal()&&this.setState({isMobile:!0})}render(){return e.jsx(s.Page,{statusBarMode:"light",children:e.jsxs(s.View,{inlineStyle:[{enable:l(()=>this.state.isMobile),name:"动态样式1",style:{display:"flex",flexDirection:"column"}}],className:"register__vw",children:[e.jsx(s.View,{inlineStyle:[{enable:l(()=>this.state.isMobile),name:"动态样式1",style:{flex:0}}],className:"register__vw__vw M-flex-item",children:e.jsx(s.Image,{style:l(()=>this.state.isMobile?{width:"auto",height:w(100)}:{width:"80%"}),src:"https://file.mengti.cc/FqgZfRkiyyY6CjhQ3eY4i4Z49HFv",remote:!1,fit:!1})}),e.jsx(s.View,{inlineStyle:[{enable:l(()=>this.state.isMobile),name:"动态样式1",style:{display:"flex",flexDirection:"column",alignItems:"flex-start",justifyContent:"flex-start",paddingTop:w(30),paddingLeft:w(20),paddingRight:w(20),borderBottomLeftRadius:w(0)}}],className:"register__vw__vw1 M-flex-item",children:e.jsxs(s.View,{inlineStyle:[{enable:l(()=>this.state.isMobile),name:"动态样式1",style:{width:"100%"}}],className:"register__vw__vw1__vw",children:[e.jsx(s.View,{children:e.jsx(s.Text,{className:"register__tx",children:"新用户注册"})}),e.jsx(s.View,{className:"register__vw__vw1__vw__vw1",children:e.jsx(s.Text,{ref:this._refsManager.linkRef("text-ac6a8287"),className:"register__vw__vw1__vw__vw1__tx"})}),e.jsxs(s.View,{className:"register__vw__vw1__vw__vw2",children:[e.jsx(s.View,{className:"register__vw__vw1__vw__vw2__vw",children:e.jsx(s.AtIcon,{color:"#98b0f5",size:24,svg:p.svg_shoabc})}),e.jsx(s.View,{className:"register__vw__vw1__vw__vw2__vw1 M-flex-item",children:e.jsx(m,{placeholder:"用户名",bordered:!1,disabled:!1,allowClear:!0,value:l(()=>this.state.account),onChange:function(){return this.setStateValue.apply(this,Array.prototype.slice.call(arguments).concat([{field:"account",valueField:"target.value"}]))}.bind(this),ref:this._refsManager.linkRef("input-3eae6345"),className:"register__vw__vw1__vw__vw2__vw1__Input"})})]}),e.jsxs(s.View,{className:"register__vw__vw1__vw__vw3",children:[e.jsx(s.View,{className:"register__vw__vw1__vw__vw3__vw",children:e.jsx(s.AtIcon,{color:"#98b0f5",size:24,svg:p.svg_2po9fe})}),e.jsx(s.View,{className:"register__vw__vw1__vw__vw3__vw1 M-flex-item",children:e.jsx(m.Password,{bordered:!1,disabled:!1,visibilityToggle:!0,placeholder:"密码",value:l(()=>this.state.password),onChange:function(){return this.setStateValue.apply(this,Array.prototype.slice.call(arguments).concat([{field:"password",valueField:"target.value"}]))}.bind(this),onPressEnter:function(){return this.register.apply(this,Array.prototype.slice.call(arguments).concat([]))}.bind(this),className:"register__vw__vw1__vw__vw3__vw1__Input.Password"})})]}),!1,e.jsxs(s.View,{className:"register__vw__vw1__vw__vw5",children:[e.jsx(s.View,{onClick:t=>{this.utils.navigateTo("login")},className:"register__vw__vw1__vw__vw5__vw M-gb-click",children:e.jsx(s.Text,{className:"register__vw__vw1__vw__vw5__vw__tx",children:"已有账号？去登录"})}),e.jsx(s.View,{className:"register__vw__vw1__vw__vw5__vw1 M-flex-item"})]}),e.jsxs(s.View,{onClick:function(){return this.register.apply(this,Array.prototype.slice.call(arguments).concat([]))}.bind(this),className:"register__vw__vw1__vw__vw6 M-gb-click",children:[e.jsx(s.Text,{className:"register__vw__vw1__vw__vw6__tx",children:"确认注册"}),e.jsx(s.View,{className:"register__vw__vw1__vw__vw6__vw1"})]})]})})]})})}}export{k as default};
